% trying to fit the log log stuff
clear all

x = [-1.15876822231091	0.563294762360461	-1.16109348200004	-0.854510031611449	23.0481427884960	47.4379871773434	72.4191414607131	103.637462973730	127.961644747692	157.369346060681	179.109276090267	199.972760067274	227.713011533692	252.187140524786	273.145098129592	285.984870053930	308.380146247567	321.612568307958	328.321737785892	320.223973059066	1.56835733980565	2.19199154353728	0.824903461941377	4.08451307161657	16.5071315087065	45.2676804512808	69.6315734862199	98.9503811228738	124.827311647564	147.268650896984	176.138451747815	197.011546848840	225.960075830961	243.825542795337	262.430885754849	281.318401646442	297.935077378831	313.235013042223	315.430687222595	314.142108123975	0.336783805881117	-3.13023803401962	-2.78303807064233	-2.52544199524934	-1.73610664991035	28.4166978230199	54.3396807574932	80.9593886872915	106.897639252433	133.149304932393	156.976767413198	183.925803749235	203.673481386875	227.640930577769	244.711099018397	266.911655223676	279.824069826759	297.626334429731	308.272732936868	304.020926812546	-1.26089270055959	-2.13727286085263	-0.117302884391595	-1.65051757581072	-1.47255857646296	21.9208256900439	50.5622011489821	75.1055202042815	100.950875021739	127.498157391348	153.368869841816	175.838579600890	195.222075956822	219.704612971876	238.400806712500	258.865398823820	274.507799503795	287.198707711104	296.467978951585	297.398551027611	0.894820147725255	2.77488326294220	3.60303822243339	3.66510909273471	19.7000282298198	45.0041141812294	75.8696133837572	95.2391780737747	121.516648512169	146.404902993817	172.042003991008	190.956121682811	215.343711122077	237.277204517785	252.858892650548	270.225153444312	283.339084613777	296.543499669349	299.338369456477	297.250054528387];
y = [-0.000598667361642726	-0.00405149396955360	-0.00531825919825904	-0.000294620971633382	-0.000813541628742274	0.00994987575587139	0.00310556482560043	0.000418092138642703	0.00635840066344763	0.00509323289527857	0.00792973771882387	0.00756300425241869	0.0112762349221460	0.0113833326983611	0.0310148625531213	0.0156460557771851	0.0193942130825403	0.0330100716453048	0.000318655883053970	-0.00750175213476391	-0.000711282158940949	0.00101915039014531	-0.000779923362466292	-0.00267286111648038	0.00497385384324097	-0.000860510666865711	0.00614663566916493	0.00530917691639163	0.00271303975676158	0.00636441220694890	0.0111774866649874	0.00360497711079455	0.0145168132951476	0.0188707308640134	0.0141838964604546	0.0186004461488958	0.0410924668056918	0.0397831707625632	-2.97841850558525e-05	-0.00556963219533335	-0.00196810404676071	9.33548532374156e-05	-0.00232720193672924	-0.00200360983593748	-0.000708469895365388	0.000668916015374606	0.00491449840105874	0.00459184647715127	0.000717757728778280	0.00417555206195542	0.00726758410254663	0.0136562431613340	0.0116794981463537	0.00670517793592014	0.0300081216763497	0.0316136128938150	0.0349472784436746	0.0506579962968647	0.0354471844349595	-0.00346416824577176	0.000425240163011297	-0.000603101920968657	-0.00246009249833104	-0.00423287046203689	-2.17511314857434e-05	0.000569218382427605	0.00348950791714464	0.00701566224177318	0.00154397810193578	0.00727926259651507	0.00740826657765409	0.00756067896087601	0.0146297762137840	0.0150791844133324	0.0108699245601330	0.0264353159840194	0.0327057945043517	0.0469667661268368	0.0336089771170993	-0.00281734671989690	-0.00128917570480918	-0.00329420908794490	-0.000643036175451362	-6.08400446550138e-05	0.00141202809424461	0.000840422651499656	0.00742016840719850	0.00534555576757384	0.00337824753317096	0.00681411394006961	0.0131241702447733	0.0181708375649712	0.0121515225046638	0.0220257775478846	0.0198238371240019	0.0323109440454105	0.0326439403028621	0.0484402878219988	-0.00321088728495433	0.000695600019136317];

slope_1 = [];
intercept_1 = [];

slope_2 = [];
intercept_2 = [];

x_region = (x > 10) & (x < 350);
xfit = x(x_region);
yfit = y(x_region);

n = length(x)/20;


x_all = zeros(n,20);
y_all = zeros(n,20);


for i = 0:(n-1)
    test = x((20*i) + 1: 20*(i+1));
    x_all(i + 1,:) = x((20*i) + 1: 20*(i+1));
    y_all(i + 1,:) = y((20*i) + 1: 20*(i+1));
end

% x1 = x(1:n);
% x2 = x(n+1:2*n);
% x3 = x(2*n+1:3*n);
% x4 = x(3*n+1:4*n);
% x5 = x(4*n+1:5*n);
% % x6 = x(5*n+1:6*n)
% x_all = [x1;x2;x3;x4;x5]; %;x6];
% 
% y1 = y(1:n);
% y2 = y(n+1:2*n);
% y3 = y(2*n+1:3*n);
% y4 = y(3*n+1:80);
% y5 = y(4*n+1:5*n);
% % y6 = y(5*n+1:6*n)
% y_all = [y1;y2;y3;y4;y5]; %;y6];

for i = 1:n

    % Define the regions for fitting
    xLowerBound1 = 2; % Lower bound of x for region 1
    xUpperBound1 = 166; % Upper bound of x for region 1
    xLowerBound2 = 166; % Lower bound of x for region 2
    xUpperBound2 = 300; % Upper bound of x for region 2

    x = x_all(i,:);
    y = y_all(i,:);
    % Create logical indices for the regions
    region1 = (x >= xLowerBound1) & (x  <= xUpperBound1);
    region2 = (x >= xLowerBound2) & (x <= xUpperBound2);
    
    % Transform the data
    log_x = log10(x);
    log_y = log10(y);
    
    % Linear fit for region 1
    coeffs1 = polyfit(log_x(region1), log_y(region1), 1);
    slope1 = coeffs1(1);
    intercept1 = coeffs1(2);
    slope_1 = [slope_1,slope1];
    intercept_1 = [intercept_1,intercept1];
    
    % Linear fit for region 2
    coeffs2 = polyfit(log_x(region2), log_y(region2), 1);
    slope2 = coeffs2(1);
    intercept2 = coeffs2(2);

    if slope2 > 1
        slope_2 = [slope_2,slope2];
        intercept_2 = [intercept_2,intercept2];
    end
    
    figure(1)
    % Plot the original data on a log-log plot
    loglog(x,y, 'o');
    hold on;
    
    % Plot the first linear fit for region 1
    loglog(x(region1), 10.^(polyval(coeffs1, log_x(region1))), 'r-', LineWidth=2);
    
    % Plot the second linear fit for region 2
    loglog(x(region2), 10.^(polyval(coeffs2, log_x(region2))), 'g-', LineWidth=2);
    
    hold off;
    
    % Display the results
    fprintf('Region 1 - Slope: %f, Intercept: %f\n', slope1, intercept1);
    fprintf('Region 2 - Slope: %f, Intercept: %f\n', slope2, intercept2);
end

slope_1 = real(slope_1);
intercept_1 = real(intercept_1);
avg_slope_1 = mean(slope_1);
avg_intercept_1 = mean(intercept_1);

slope_2 = real(slope_2);
intercept_2 = real(intercept_2);
avg_slope_2 = mean(slope_2);
avg_intercept_2 = mean(intercept_2);

figure(2)
loglog(xfit,yfit,'o', Color=[0 0 0], LineWidth=2);
hold on

x_domain = linspace(0,500,100);
% Calculate the y values on the log scale
log_y_fit_1 = avg_slope_1 * log10(x_domain) + avg_intercept_1;
% Convert the y values back from log scale to the original scale
y_fit_1 = 10.^(log_y_fit_1);
log_y_fit_2 = avg_slope_2 * log10(x_domain) + avg_intercept_2;
% Convert the y values back from log scale to the original scale
y_fit_2 = 10.^(log_y_fit_2);

% Overlay the linear fit line
loglog(x_domain, y_fit_1, 'r-', 'LineWidth', 2);
hold on
loglog(x_domain, y_fit_2, 'g-', 'LineWidth', 2);
hold on 
xlabel('Droplet Indentation (nm)');
ylabel('Effective Droplet Stifness (pN/nm)')
hold off












